# Internationalization (i18n) Support

Docs4ai supports multiple languages using `i18next`. Both the system tray menu and the main UI are fully translated and can be switched instantly without restarting the app.

## Supported Languages

Docs4ai supports **9 languages**:

- ðŸ‡¬ðŸ‡§ **English (en)** - Default
- ðŸ‡«ðŸ‡· **French (fr)** - FranÃ§ais  
- ðŸ‡ªðŸ‡¸ **Spanish (es)** - EspaÃ±ol
- ðŸ‡¨ðŸ‡³ **Chinese (zh)** - ä¸­æ–‡ (Mandarin)
- ðŸ‡®ðŸ‡³ **Hindi (hi)** - à¤¹à¤¿à¤¨à¥à¤¦à¥€
- ðŸ‡¸ðŸ‡¦ **Arabic (ar)** - Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
- ðŸ‡©ðŸ‡ª **German (de)** - Deutsch
- ðŸ‡®ðŸ‡¹ **Italian (it)** - Italiano
- ðŸ‡µðŸ‡¹ **Portuguese (pt)** - PortuguÃªs

## How It Works

### Architecture

1. **Main Process (main.ts)**: Uses i18n for tray menu translations
2. **Translation Files**: JSON files in `src/locales/` directory
3. **Language Preference**: Stored in `electron-store` and persists across restarts
4. **Auto-detection**: Uses system locale on first launch

### Current Implementation

âœ… **System Tray Menu** - Fully translated
- Tooltip text
- Menu items (Active, Profiles, Show App, Quit)
- Status messages (syncing, processing, etc.)

âœ… **Main UI** - Fully translated
- All form labels and buttons
- Profile settings
- MCP server controls
- Status messages and dialogs
- Database browser

âœ… **Language Switching** - Instant, no restart required
- `get-language` - Get current language
- `get-available-languages` - Get list of supported languages
- `set-language` - Change language (updates UI and tray immediately)
- `get-translations` - Load translation JSON for renderer process

## Renderer Process Implementation

The renderer process uses a lightweight translation system that loads translations via IPC:

```javascript
// Simple translation function in index.html
let translations = {};

function t(key, options = {}) {
    const keys = key.split('.');
    let value = translations;
    for (const k of keys) {
        value = value?.[k];
        if (value === undefined) return key;
    }
    
    // Simple interpolation
    if (options && typeof value === 'string') {
        return value.replace(/\{\{(\w+)\}\}/g, (match, key) => {
            return options[key] !== undefined ? options[key] : match;
        });
    }
    
    return value;
}

// Load translations via IPC
async function loadTranslations(locale) {
    translations = await window.api.getTranslations(locale);
}

// Update UI when language changes
function updateUI() {
    // Update all UI elements using t() function
    document.getElementById('startBtn').textContent = t('ui.startSyncing');
    // ... etc
}
```

This approach avoids bundling i18next in the renderer while still providing full translation support.

## Adding a New Language

1. **Create translation file**: `src/locales/{code}.json`
   ```json
   {
     "tray": {
       "showApp": "Afficher Docs4ai",
       "quit": "Quitter"
     }
   }
   ```

2. **Add to available languages**: Update `src/i18n.ts`
   ```typescript
   // Update supportedLocales array
   const supportedLocales = ['en', 'fr', 'es', 'zh', 'hi', 'ar', 'de', 'it', 'pt', 'ja']; // Add 'ja' for Japanese
   
   // Update getAvailableLanguages function
   export function getAvailableLanguages(): string[] {
     return ['en', 'fr', 'es', 'zh', 'hi', 'ar', 'de', 'it', 'pt', 'ja'];
   }
   ```

3. **Add to language selector**: Update `src/index.html`
   ```html
   <select id="languageSelect">
     <!-- ... existing options ... -->
     <option value="ja">æ—¥æœ¬èªž</option>
   </select>
   ```

3. **Translate all keys**: Copy structure from `en.json` and translate values

## Translation Keys Structure

```
app.*          - Application name/title
tray.*         - System tray menu items
profile.*      - Profile settings UI
mcp.*          - MCP server UI
common.*       - Common buttons/messages
ui.*           - Main UI elements (buttons, labels, messages)
```

All translation files follow the same structure. See `src/locales/en.json` for the complete reference.

## Usage Examples

### In Main Process
```typescript
import { t } from './i18n';

const menuLabel = t('tray.showApp');
const syncingText = t('tray.syncing', { count: 2 }); // "2 profile(s) syncing"
```

### Changing Language
```typescript
import { changeLanguage } from './i18n';

await changeLanguage('fr');
updateTray(); // Refresh tray menu
```

### Via IPC (from renderer)
```javascript
// Get current language
const lang = await window.api.getLanguage();

// Get available languages
const langs = await window.api.getAvailableLanguages();

// Load translations for current language
const translations = await window.api.getTranslations(lang);

// Change language (updates UI and tray immediately)
await window.api.setLanguage('fr');

// Listen for language changes
window.api.onLanguageChanged(async (locale) => {
    await loadTranslations(locale);
    updateUI();
});
```

## Language Detection

The app detects language in this order:
1. User preference (saved in settings)
2. System locale (`app.getLocale()`)
3. Environment variable (`LANG`)
4. Fallback to English

## Notes

- âœ… Language preference is saved automatically when changed
- âœ… Tray menu updates immediately when language changes
- âœ… UI updates immediately when language changes (no restart required)
- âœ… All translation files use UTF-8 encoding
- âœ… Translation files are automatically copied to `dist/locales/` during build
- âœ… Missing translations fall back to English automatically
- âœ… Language detection uses system locale on first launch

## Build Process

Translation files are automatically copied during the build process via the `copy-locales` script in `package.json`:

```json
{
  "scripts": {
    "build": "tsc && npm run copy-locales",
    "copy-locales": "mkdir -p dist/locales && cp -r src/locales/*.json dist/locales/"
  }
}
```

This ensures all translation files are available at runtime in the `dist/` directory.
